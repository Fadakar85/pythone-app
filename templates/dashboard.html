{% extends "base.html" %}

{% block content %}
<div class="mb-3">
    <p class="txt-black">تغییر تم:</p>
    <button id="toggleButton" class="header-tabs rounded-2">
        <i id="themeIcon" class="bi bi-moon icon txt-black"></i>
    </button>
</div>

<form method="POST" class="mb-5">
    {{ form.hidden_tag() }}

    <div class="form-group mb-1">
        <label for="username" class="txt-black">نام کاربری</label>
        {{ form.username(class="inputs txt-black", id="username") }}
    </div>

    <div class="form-group mt-3 mb-1">
        <label for="email" class="txt-black">ایمیل</label>
        {{ form.email(class="inputs txt-black", id="email") }}
    </div>

    <button type="submit" class="btn btn-primary header-tabs mt-3" style="cursor: pointer;">{{ form.submit.label }}</button>
</form>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="txt-black">محصولات من</h2>
    <a href="{{ url_for('main.new_product') }}" class="btn btn-primary d-flex align-items-center">اضافه کردن محصول <i class="bi bi-plus fw-bolder fs-4"></i></a>
</div>

<div class="row row-cols-1 row-cols-md-3 g-4" style="margin-bottom: 6rem;">
    {% for product in products %}
    <div class="col">
        <div class="card productes h-100 header-tabs">
            {% if product.image_path %}
            <img src="{{ url_for('static', filename='uploads/' + product.image_path) }}" class="card-img-top" alt="{{ product.name }}">
            {% endif %}
            <div class="card-body">
                <h5 class="card-title txt-black">{{ product.name }}</h5>
                <p class="card-text description px-3 txt-black">{{ product.description }}</p>
                {% if product.price == product.price|int %}
                  <p class="card-text txt-black"><strong>{{ "{:,}".format(product.price | int) }} تومان</strong></p>
                {% else %}
                  <p class="card-text txt-black"><strong>{{ "{:,.2f}".format(product.price) }} تومان</strong></p>
                {% endif %}
                <div class="d-flex justify-content-between">
                    <a href="{{ url_for('main.edit_product', id=product.id) }}" class="btn btn-secondary header-tabs m-0">ویرایش</a>
                    <form action="{{ url_for('main.delete_product', id=product.id) }}" method="POST" class="d-inline m-0">
                        <button type="submit" class="btn btn-danger header-tabs m-0" onclick="return confirm('Are you sure?')">حذف محصول</button>
                    </form>

                    {% if product.user_id == current_user.id %}
                        <form action="{{ url_for('main.remove_promotion', product_id=product.id) }}" method="POST" class="header-tabs m-0">
                            <button type="submit" class="btn btn-danger m-0">حذف نردبان</button>
                        </form>
                    {% endif %}

                    {% if product.user_id == current_user.id %}
                        <a href="{{ url_for('main.start_payment', product_id=product.id) }}" class="btn btn-success m-0">نردبان کردن</a>
                    {% endif %}


                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
<script>
    const button = document.getElementById("toggleButton");
        const themeIcon = document.getElementById("themeIcon");
        const root = document.documentElement;

        // بررسی اینکه آیا در Local Storage اطلاعاتی ذخیره شده است یا خیر
        const savedTheme = localStorage.getItem("theme");

        if (savedTheme) {
            // اگر تم ذخیره شده باشد، آن را اعمال می‌کنیم
            if (savedTheme === "dark") {
                setDarkMode();
            } else {
                setLightMode();
            }
        } else {
            // اگر تم ذخیره نشده باشد، وضعیت پیش‌فرض را لایت مود قرار می‌دهیم
            setLightMode();
        }

        // تابع برای تغییر به دارک مود
        function setDarkMode() {
            root.style.setProperty("--black-color", "#1C1C1E");
            root.style.setProperty("--dark-green", "#3A3A3C");
            root.style.setProperty("--light-green", "#9B1B30");
            root.style.setProperty("--light-white", "#f1f1f1");
            root.style.setProperty("--txt-color", "#F8F8F8");
            themeIcon.classList.remove("bi-moon");
            themeIcon.classList.add("bi-brightness-high");
            localStorage.setItem("theme", "dark"); // ذخیره حالت دارک مود
        }

        // تابع برای تغییر به لایت مود
        function setLightMode() {
            root.style.setProperty("--black-color", "#F8F8F8");
            root.style.setProperty("--dark-green", "#E0E0E0");
            root.style.setProperty("--light-green", "#9B1B30");
            root.style.setProperty("--light-white", "#F1F1F1");
            root.style.setProperty("--txt-color", "#1C1C1E");
            themeIcon.classList.remove("bi-brightness-high");
            themeIcon.classList.add("bi-moon");
            localStorage.setItem("theme", "light"); // ذخیره حالت لایت مود
        }

        // اضافه کردن رویداد کلیک به دکمه برای تغییر حالت تم
        button.addEventListener("click", function() {
            const currentTheme = localStorage.getItem("theme");

            if (currentTheme === "light") {
                setDarkMode();
            } else {
                setLightMode();
            }
        });
</script>
{% endblock %}